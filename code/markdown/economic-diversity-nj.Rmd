---
title: "Economic Diversity in New Jersey"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE)

library(dplyr)
library(DT)
library(here)
library(plotly)
library(scales)

data_econ = read.csv(here::here('data/output/NJ_diversity_econ.csv'),
                     stringsAsFactors = FALSE)

data_econ_display = data_econ %>%
  mutate(econ_diversity = percent(econ_diversity,
                                  accuracy = 0.01)) %>%
  select(Municipality = municipality,
         County = county,
         `Econ Diversity Rank` = econ_diversity_rank,
         `Economic Diversity` = econ_diversity)

```



To give credit where it's due, 
[Disha Raychaudhuri](https://www.nj.com/data/2019/04/nj-towns-are-increasingly-becoming-rich-or-poor-is-the-middle-class-disappearing.html)
of NJ Advance Media already did this. They calculated the economic diversity
index for every NJ town, but only published the results for the top 10 most
diverse towns. I was able to reproduce their results and provide them in full
below. I only did so for towns with more than the median number of
households: 2,979.

# Measuring Diversity

In a [past post](https://everetr.github.io/2019/04/racial-diversity-nj/) I
calculated a racial diversity index for every town in NJ. We use can use the
[same index](https://en.wikipedia.org/wiki/Diversity_index#Gini%E2%80%93Simpson_index) 
to measure economic diversity.

The value of this index for a given municipality can be interpreted as the probability that two randomly selected households belong to different income
brackets. For example: Two random households of Jersey City have about an 89.2%
chance of this.

The brackets I use here come from the 
[US Census Bureau](https://factfinder.census.gov/bkmk/table/1.0/en/ACS/17_5YR/S1901/0100000US|0400000US34.06000).
They are:

* Less than $10,000
* \$10,000 to \$14,999
* \$15,000 to \$24,999
* \$25,000 to \$34,999
* \$35,000 to \$49,999
* \$50,000 to \$74,999
* \$75,000 to \$99,999
* \$100,000 to \$149,999
* \$150,000 to \$199,999
* $200,000 or more

They're a bit narrow and numerous. Maybe later I'll have the capacity to use
microdata and play around with different brackets. But the results really
shouldn't change that much, and the Census Bureau did the heavy lifting for me
already, so...

# The Data

I got [number of households per income bracket] from the American Community
Survey (ACS), conducted by the US Census Bureau every year. This gives me a
representative sample of everyone living in every town from 2013 to 2017, though
the data are less reliable for places with lower population.

# Results

The value of the diversity index for the entire state of New Jersey is
`r unique(data_econ$state_econ_diversity) %>% percent()`.[^1] This is the
probability that two random households in NJ belong to different income
brackets. In the median town, that probability is about
`r median(data_econ$econ_diversity) %>% percent(accuracy = 0.01)`. Only
`r sum(data_econ$more_econ_diverse_than_state)` towns are more economically
diverse than the state. The table below contains economic diversity index
estimates and other indicators for every municipality in New Jersey with
household counts greater than the median.

```{r}

data_econ_display %>%
  datatable(rownames = FALSE,
            options = list(
              columnDefs = list(
                list(className = 'dt-left', 
                     targets = 0:3)
              )))

```

Notice that every town's economic diversity index value is greater than 70%.
This is probably due to how narrow the brackets are; it's easier for two random
households to belong to different income brackets. Recall that, when I
calculated 
[racial diversity indexes](https://everetr.github.io/2019/04/racial-diversity-nj/) 
for these towns, most towns didn't have a value above 50%. There were only 7
racial groups in that analysis. Again, maybe later I'll be willing/able to
define only 7 income brackets and use ACS microdata to get index estimates
(*quantitative* results, in econspeak) more comparable to the racial diversity
index values in my past post. But again, the *qualitative* results (the
rankings) shouldn't change if I do that, so it's not high priority.

<!-- plotly scatter plot of econ diversity vs median household income -->
<!-- plotly scatter plot of econ diversity vs racial diversity -->
<!-- ggplot bar charts of bracket proportions for top & bottom diverse towns -->
<!-- leaflet map -->

# Attributions

# Notes

[^1]: I obtained statewide income bracket data
[here](https://factfinder.census.gov/bkmk/table/1.0/en/ACS/17_5YR/S1901/0100000US|0400000US34).
